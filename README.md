# Order Processing Service

–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ Go, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö. –°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π **Kafka**, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö **PostgreSQL** –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ REST API –∏ –ø—Ä–æ—Å—Ç–æ–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

-   **–Ø–∑—ã–∫:** Go 1.24+
-   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL
-   **–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π:** Apache Kafka
-   **HTTP Framework:** Gin
-   **–î—Ä–∞–π–≤–µ—Ä PostgreSQL:** pgx
-   **–†–∞–±–æ—Ç–∞ —Å Kafka:** segmentio/kafka-go
-   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** godotenv, cleanenv
-   **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker, Docker Compose

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã


### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1.  **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone https://github.com/stpnv0/WB-Tech-School-L0.git
    cd order-service
    ```

2.  **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
    –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
    ```bash
    cp .env.example .env
    ```

3.  **–ü–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**
    ```bash
    docker compose up -d --build
    ```

4.  **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ kafka —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç - –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 4 —Å–æ–æ–±—â–µ–Ω–∏—è: 2 –≤–∞–ª–∏–¥–Ω—ã—Ö(b563feb7b2b84b6test, ok_multi_items_1), 2 –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö (mismatch_tx, bad_json):**
    ```bash
    chmod +x scripts/send_test_orders.sh
    ./scripts/send_test_orders.sh
    ```
5. **–ó–∞–π–¥–∏—Ç–µ –Ω–∞ UI (http://localhost:8081) –∏ –≤–≤–µ–¥–∏—Ç–µ order_uid –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:** 
    ```
    b563feb7b2b84b6test
    ```
    ```
    ok_multi_items_1
    ```
#### **P.s. –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ JSON'—ã (mismatch_tx, bad_json) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ DLQ**

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Order-service

```
.
‚îú‚îÄ‚îÄ cmd/app/              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (main.go)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ cache/            # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è LRU-–∫–µ—à–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (.env)
‚îÇ   ‚îú‚îÄ‚îÄ handlers/         # HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (Gin)
‚îÇ   ‚îú‚îÄ‚îÄ kafka/            # Kafka-–∫–æ–Ω—Å—å—é–º–µ—Ä –∏ –ø—Ä–æ–¥—é—Å–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ models/           # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (–∑–∞–∫–∞–∑—ã, –ø–ª–∞—Ç–µ–∂–∏ –∏ —Ç.–¥.)
‚îÇ   ‚îú‚îÄ‚îÄ repository/       # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (PostgreSQL)
‚îÇ   ‚îú‚îÄ‚îÄ router/           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ HTTP
‚îÇ   ‚îú‚îÄ‚îÄ service/          # –°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ validator/        # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Kafka
‚îú‚îÄ‚îÄ migrations/           # SQL-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ scripts/              # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö)
‚îú‚îÄ‚îÄ web/static/           # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ .env.example          # –®–∞–±–ª–æ–Ω —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ Dockerfile            # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ go.mod                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
```
